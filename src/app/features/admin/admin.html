<div class="admin-container">
    <div class="admin-header">
      <h1>Admin Dashboard</h1>
      <div class="admin-actions">
        <button class="btn btn-primary" (click)="refreshData()">
          <span>üîÑ</span>
          Refresh
        </button>
      </div>
    </div>

    <!-- Analytics Section -->
    <div class="analytics-section">
      <div class="stat-card">
        <h3>Total Requests</h3>
        <div class="stat-number">{{ requests.length }}</div>
      </div>
      <div class="stat-card">
        <h3>Pending</h3>
        <div class="stat-number pending">{{ getRequestsByStatus(RequestStatus.PENDING).length }}</div>
      </div>
      <div class="stat-card">
        <h3>In Progress</h3>
        <div class="stat-number in-progress">{{ getRequestsByStatus(RequestStatus.IN_PROGRESS).length }}</div>
      </div>
      <div class="stat-card">
        <h3>Completed</h3>
        <div class="stat-number completed">{{ getRequestsByStatus(RequestStatus.COMPLETED).length }}</div>
      </div>
      <div class="stat-card">
        <h3>On Hold</h3>
        <div class="stat-number on-hold">{{ getRequestsByStatus(RequestStatus.ON_HOLD).length }}</div>
      </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
      <div class="filter-group">
        <label for="statusFilter">Filter by Status:</label>
        <select id="statusFilter" [(ngModel)]="selectedStatus" (change)="filterRequests()" class="filter-select">
          <option value="">All Statuses</option>
          <option [value]="RequestStatus.PENDING">{{ RequestStatus.PENDING }}</option>
          <option [value]="RequestStatus.IN_PROGRESS">{{ RequestStatus.IN_PROGRESS }}</option>
          <option [value]="RequestStatus.COMPLETED">{{ RequestStatus.COMPLETED }}</option>
          <option [value]="RequestStatus.CANCELLED">{{ RequestStatus.CANCELLED }}</option>
          <option [value]="RequestStatus.ON_HOLD">{{ RequestStatus.ON_HOLD }}</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="serviceFilter">Filter by Service:</label>
        <select id="serviceFilter" [(ngModel)]="selectedService" (change)="filterRequests()" class="filter-select">
          <option value="">All Services</option>
          <option [value]="ServiceType.WEB_DEVELOPMENT">{{ ServiceType.WEB_DEVELOPMENT }}</option>
          <option [value]="ServiceType.DATA_MANAGEMENT">{{ ServiceType.DATA_MANAGEMENT }}</option>
          <option [value]="ServiceType.ETL_PROCESS">{{ ServiceType.ETL_PROCESS }}</option>
          <option [value]="ServiceType.CLOUD_HOSTING">{{ ServiceType.CLOUD_HOSTING }}</option>
          <option [value]="ServiceType.CUSTOM_INQUIRY">{{ ServiceType.CUSTOM_INQUIRY }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="searchFilter">Search:</label>
        <input 
          id="searchFilter" 
          type="text" 
          [(ngModel)]="searchTerm" 
          (input)="filterRequests()" 
          placeholder="Search by user name, email, or title..."
          class="filter-input">
      </div>
    </div>

    <!-- Requests Table -->
    <div class="requests-section">
      <h2>All Requests ({{ filteredRequests.length }})</h2>
      
      <div *ngIf="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading requests...</p>
      </div>

      <div *ngIf="!loading && filteredRequests.length === 0" class="empty-state">
        <p>No requests found matching your criteria.</p>
      </div>

      <div *ngIf="!loading && filteredRequests.length > 0" class="requests-table-container">
        <table class="requests-table">
          <thead>
            <tr>
              <th>User</th>
              <th>Title</th>
              <th>Service</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let request of filteredRequests; trackBy: trackByRequestId" 
                class="request-row"
                [class.editing]="editingRequest?.id === request.id">
              <td>
                <div class="user-info">
                  <div class="user-name">{{ request.userName }}</div>
                  <div class="user-email">{{ request.userEmail }}</div>
                </div>
              </td>
              <td>
                <div class="request-title">{{ request.title }}</div>
                <div class="request-description">{{ truncateDescription(request.description) }}</div>
              </td>
              <td>
                <span class="service-badge">{{ request.service }}</span>
              </td>
              <td>
                <div *ngIf="editingRequest?.id !== request.id">
                  <span class="status-badge" [class]="'status-' + request.status.toLowerCase().replace(' ', '-')">
                    {{ request.status }}
                  </span>
                </div>
                <div *ngIf="editingRequest?.id === request.id">
                  <select [(ngModel)]="editForm.status" class="status-select">
                    <option [value]="RequestStatus.PENDING">{{ RequestStatus.PENDING }}</option>
                    <option [value]="RequestStatus.IN_PROGRESS">{{ RequestStatus.IN_PROGRESS }}</option>
                    <option [value]="RequestStatus.COMPLETED">{{ RequestStatus.COMPLETED }}</option>
                    <option [value]="RequestStatus.CANCELLED">{{ RequestStatus.CANCELLED }}</option>
                    <option [value]="RequestStatus.ON_HOLD">{{ RequestStatus.ON_HOLD }}</option>
                  </select>
                </div>
              </td>
              <td>
                <div class="date-info">
                  <div>{{ formatDate(request.createdAt) }}</div>
                  <div class="date-sub">{{ formatTime(request.createdAt) }}</div>
                </div>
              </td>
              <td>
                <div class="action-buttons">
                  <div *ngIf="editingRequest?.id !== request.id">
                    <button class="btn btn-sm btn-edit" (click)="startEdit(request)">
                      <span>‚úèÔ∏è</span>
                      Edit
                    </button>
                    <button class="btn btn-sm btn-view" (click)="viewRequest(request)">
                      <span>üëÅÔ∏è</span>
                      View
                    </button>
                  </div>
                  <div *ngIf="editingRequest?.id === request.id" class="edit-actions">
                    <button class="btn btn-sm btn-save" (click)="saveEdit()" [disabled]="saving">
                      <span *ngIf="!saving">üíæ</span>
                      <span *ngIf="saving">‚è≥</span>
                      {{ saving ? 'Saving...' : 'Save' }}
                    </button>
                    <button class="btn btn-sm btn-cancel" (click)="cancelEdit()">
                      <span>‚ùå</span>
                      Cancel
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Edit Modal -->
    <div *ngIf="editingRequest && showModal" class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Edit Request: {{ editingRequest.title }}</h3>
          <button class="modal-close" (click)="closeModal()">√ó</button>
        </div>
        
        <div class="modal-body">
          <div class="form-group">
            <label>Status</label>
            <select [(ngModel)]="editForm.status" class="form-control">
              <option [value]="RequestStatus.PENDING">{{ RequestStatus.PENDING }}</option>
              <option [value]="RequestStatus.IN_PROGRESS">{{ RequestStatus.IN_PROGRESS }}</option>
              <option [value]="RequestStatus.COMPLETED">{{ RequestStatus.COMPLETED }}</option>
              <option [value]="RequestStatus.CANCELLED">{{ RequestStatus.CANCELLED }}</option>
              <option [value]="RequestStatus.ON_HOLD">{{ RequestStatus.ON_HOLD }}</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Admin Notes</label>
            <textarea 
              [(ngModel)]="editForm.adminNotes" 
              class="form-control" 
              rows="4"
              placeholder="Add internal notes about this request..."></textarea>
          </div>
          
          <div class="request-details">
            <h4>Request Details</h4>
            <div class="detail-row">
              <strong>User:</strong> {{ editingRequest.userName }} ({{ editingRequest.userEmail }})
            </div>
            <div class="detail-row">
              <strong>Service:</strong> {{ editingRequest.service }}
            </div>
            <div class="detail-row">
              <strong>Description:</strong> {{ editingRequest.description }}
            </div>
            <div class="detail-row">
              <strong>Created:</strong> {{ formatDateTime(editingRequest.createdAt) }}
            </div>
            <div *ngIf="editingRequest.attachments && editingRequest.attachments.length > 0" class="detail-row">
              <strong>Attachments:</strong>
              <ul class="attachments-list">
                <li *ngFor="let attachment of editingRequest.attachments">
                  <a [href]="attachment.url" target="_blank">{{ attachment.fileName }}</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button class="btn btn-primary" (click)="saveEdit()" [disabled]="saving">
            {{ saving ? 'Saving...' : 'Save Changes' }}
          </button>
        </div>
      </div>
    </div>
  </div>